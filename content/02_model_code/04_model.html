
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SimPy: Treatment Centre &#8212; Treatment centre simulation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/02_model_code/04_model';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Model testing" href="05_testing.html" />
    <link rel="prev" title="Model technical summary" href="03a_summary.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../front_page.html">
  
  
  
  
  
  
    <p class="title logo__title">Treatment centre simulation</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../front_page.html">
                    Preface
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Introduction</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../01_introduction/01_overview.html">Book overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_introduction/02_license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_introduction/03_citation.html">Citation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_introduction/05_contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../01_introduction/06_plain_english.html">Plain English summary</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Model code</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01_problem.html">Problem description</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_simpy.html">Simulaton Software Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_instr.html">Steps to reproduce results</a></li>
<li class="toctree-l1"><a class="reference internal" href="03a_summary.html">Model technical summary</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">SimPy: Treatment Centre</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_testing.html">Model testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_test_package.html">Python package</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">STRESS Reporting</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../03_stress/01_objectives.html">1. Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_stress/02_logic.html">2. Model logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_stress/03_data.html">3. Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_stress/04_experimentation.html">4. Experimentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_stress/05_implementation.html">5. Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../03_stress/06_code_access.html">6. Code access</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/TomMonks/treatment-centre-sim/main?urlpath=lab/tree/content/02_model_code/04_model.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/TomMonks/treatment-centre-sim" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/TomMonks/treatment-centre-sim/issues/new?title=Issue%20on%20page%20%2Fcontent/02_model_code/04_model.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/content/02_model_code/04_model.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>SimPy: Treatment Centre</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">1. Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constants-and-defaults-for-modelling-as-is">2. Constants and defaults for modelling <strong>as-is</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-parameters">2.1 Distribution parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-dependent-arrival-rates-data">2.2 Time dependent arrival rates data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resource-counts">2.3 Resource counts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-model-run-settings">2.4 Simulation model run settings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#utility-functions">3. Utility functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-classes">4. Distribution classes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-parameterisation">5. Model parameterisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#patient-pathways-process-logic">6. Patient Pathways Process Logic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-model-class">7. Main model class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logic-to-process-end-of-run-results">8. Logic to process end of run results.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-execution">9. Model execution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-run-of-the-model">9.1 Single run of the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-independent-replications">9.2 Multiple independent replications</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualise-replications">9.3 Visualise replications</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#script-to-run-scenario-analysis">10.1 Script to run scenario analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#script-to-produce-formatted-latex-table-for-paper">11. Script to produce formatted LaTeX table for paper</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#end">End</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="simpy-treatment-centre">
<h1>SimPy: Treatment Centre<a class="headerlink" href="#simpy-treatment-centre" title="Link to this heading">#</a></h1>
<div class="admonition-running-the-model admonition">
<p class="admonition-title">Running the model</p>
<p><strong>This simulation model in this notebook can be executed online. You do not need to install anything on your computer.</strong> Move you mourse cursor over the rocket ship icon above and choose one of the two options: Binder (launches an external remote instance of Jupyter-Lab) or Thebe (code cells are excutable within the book).</p>
</div>
<blockquote>
<div><p>See <a class="reference internal" href="03_instr.html"><span class="std std-doc">detailed instructions</span></a> for more help.</p>
</div></blockquote>
<hr class="docutils" />
<section id="imports">
<h2>1. Imports<a class="headerlink" href="#imports" title="Link to this heading">#</a></h2>
<p>The model is provided with a conda virtual environment <code class="docutils literal notranslate"><span class="pre">treatment_sim</span></code>.  Details are available in the <a class="reference external" href="https://github.com/pythonhealthdatascience/stars-treat-sim">Github repo</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">simpy</span>
<span class="n">simpy</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;4.1.1&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">fileinput</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="constants-and-defaults-for-modelling-as-is">
<h2>2. Constants and defaults for modelling <strong>as-is</strong><a class="headerlink" href="#constants-and-defaults-for-modelling-as-is" title="Link to this heading">#</a></h2>
<section id="distribution-parameters">
<h3>2.1 Distribution parameters<a class="headerlink" href="#distribution-parameters" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># sign-in/triage parameters</span>
<span class="n">DEFAULT_TRIAGE_MEAN</span> <span class="o">=</span> <span class="mf">3.0</span>

<span class="c1"># registration parameters</span>
<span class="n">DEFAULT_REG_MEAN</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">DEFAULT_REG_VAR</span><span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># examination parameters</span>
<span class="n">DEFAULT_EXAM_MEAN</span> <span class="o">=</span> <span class="mf">16.0</span>
<span class="n">DEFAULT_EXAM_VAR</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">DEFAULT_EXAM_MIN</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># trauma/stabilisation</span>
<span class="n">DEFAULT_TRAUMA_MEAN</span> <span class="o">=</span> <span class="mf">90.0</span>

<span class="c1"># Trauma treatment</span>
<span class="n">DEFAULT_TRAUMA_TREAT_MEAN</span> <span class="o">=</span> <span class="mf">30.0</span>
<span class="n">DEFAULT_TRAUMA_TREAT_VAR</span> <span class="o">=</span> <span class="mf">4.0</span>

<span class="c1"># Non trauma treatment</span>
<span class="n">DEFAULT_NON_TRAUMA_TREAT_MEAN</span> <span class="o">=</span> <span class="mf">13.3</span>
<span class="n">DEFAULT_NON_TRAUMA_TREAT_VAR</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># prob patient requires treatment given trauma</span>
<span class="n">DEFAULT_NON_TRAUMA_TREAT_P</span> <span class="o">=</span> <span class="mf">0.60</span>

<span class="c1"># proportion of patients triaged as trauma</span>
<span class="n">DEFAULT_PROB_TRAUMA</span> <span class="o">=</span> <span class="mf">0.12</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-dependent-arrival-rates-data">
<h3>2.2 Time dependent arrival rates data<a class="headerlink" href="#time-dependent-arrival-rates-data" title="Link to this heading">#</a></h3>
<p>The data for arrival rates varies between clinic opening at 6am and closure at 12am.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data are held in the Github repo and loaded from there.</span>
<span class="n">NSPP_PATH</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/TomMonks/&#39;</span> \
 <span class="o">+</span> <span class="s1">&#39;open-science-for-sim/main/src/notebooks/01_foss_sim/data/ed_arrivals.csv&#39;</span>

<span class="c1"># visualise</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">NSPP_PATH</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;arrival_rate&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;period&#39;</span><span class="p">,</span> <span class="n">rot</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span>
                                 <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;hour of day&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;mean arrivals&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/99a26021d5b436b5848674d9b70910261312e4223fab53ae3f0793d3e87daf49.png" src="../../_images/99a26021d5b436b5848674d9b70910261312e4223fab53ae3f0793d3e87daf49.png" />
</div>
</div>
</section>
<section id="resource-counts">
<h3>2.3 Resource counts<a class="headerlink" href="#resource-counts" title="Link to this heading">#</a></h3>
<blockquote>
<div><p>Inter count variables representing the number of resources at each activity in the processes.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DEFAULT_N_TRIAGE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">DEFAULT_N_REG</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">DEFAULT_N_EXAM</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">DEFAULT_N_TRAUMA</span> <span class="o">=</span> <span class="mi">2</span>

<span class="c1"># Non-trauma cubicles</span>
<span class="n">DEFAULT_N_CUBICLES_1</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># trauma pathway cubicles</span>
<span class="n">DEFAULT_N_CUBICLES_2</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="simulation-model-run-settings">
<h3>2.4 Simulation model run settings<a class="headerlink" href="#simulation-model-run-settings" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># default random number SET</span>
<span class="n">DEFAULT_RNG_SET</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">N_STREAMS</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1"># default results collection period</span>
<span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">*</span> <span class="mi">19</span>

<span class="c1"># number of replications.</span>
<span class="n">DEFAULT_N_REPS</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># Show the a trace of simulated events</span>
<span class="c1"># not recommended when running multiple replications</span>
<span class="n">TRACE</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="utility-functions">
<h2>3. Utility functions<a class="headerlink" href="#utility-functions" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Utility function for printing a trace as the</span>
<span class="sd">    simulation model executes.</span>
<span class="sd">    Set the TRACE constant to False, to turn tracing off.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    -------</span>
<span class="sd">    msg: str</span>
<span class="sd">        string to print to screen.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">TRACE</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="distribution-classes">
<h2>4. Distribution classes<a class="headerlink" href="#distribution-classes" title="Link to this heading">#</a></h2>
<p>To help with controlling sampling <code class="docutils literal notranslate"><span class="pre">numpy</span></code> distributions are packaged up into classes that allow easy control of random numbers.</p>
<p><strong>Distributions included:</strong></p>
<ul class="simple">
<li><p>Exponential</p></li>
<li><p>Log Normal</p></li>
<li><p>Bernoulli</p></li>
<li><p>Normal</p></li>
<li><p>Uniform</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Exponential</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convenience class for the exponential distribution.</span>
<span class="sd">    packages up distribution parameters, seed and random generator.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        ------</span>
<span class="sd">        mean: float</span>
<span class="sd">            The mean of the exponential distribution</span>
<span class="sd">        </span>
<span class="sd">        random_seed: int, optional (default=None)</span>
<span class="sd">            A random seed to reproduce samples.  If set to none then a unique</span>
<span class="sd">            sample is created.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span>
        
    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate a sample from the exponential distribution</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        size: int, optional (default=None)</span>
<span class="sd">            the number of samples to return.  If size=None then a single</span>
<span class="sd">            sample is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">exponential</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

    
<span class="k">class</span> <span class="nc">Bernoulli</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convenience class for the Bernoulli distribution.</span>
<span class="sd">    packages up distribution parameters, seed and random generator.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        ------</span>
<span class="sd">        p: float</span>
<span class="sd">            probability of drawing a 1</span>
<span class="sd">        </span>
<span class="sd">        random_seed: int, optional (default=None)</span>
<span class="sd">            A random seed to reproduce samples.  If set to none then a unique</span>
<span class="sd">            sample is created.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="n">p</span>
        
    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate a sample from the exponential distribution</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        size: int, optional (default=None)</span>
<span class="sd">            the number of samples to return.  If size=None then a single</span>
<span class="sd">            sample is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">binomial</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Lognormal</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Encapsulates a lognormal distirbution</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">stdev</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        mean: float</span>
<span class="sd">            mean of the lognormal distribution</span>
<span class="sd">            </span>
<span class="sd">        stdev: float</span>
<span class="sd">            standard dev of the lognormal distribution</span>
<span class="sd">            </span>
<span class="sd">        random_seed: int, optional (default=None)</span>
<span class="sd">            Random seed to control sampling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_moments_from_lognormal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">stdev</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        
    <span class="k">def</span> <span class="nf">normal_moments_from_lognormal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns mu and sigma of normal distribution</span>
<span class="sd">        underlying a lognormal with mean m and variance v</span>
<span class="sd">        source: https://blogs.sas.com/content/iml/2014/06/04/simulate-lognormal</span>
<span class="sd">        -data-with-specified-mean-and-variance.html</span>

<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        m: float</span>
<span class="sd">            mean of lognormal distribution</span>
<span class="sd">        v: float</span>
<span class="sd">            variance of lognormal distribution</span>
<span class="sd">                </span>
<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">        (float, float)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">phi</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">m</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
        
    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Sample from the normal distribution</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Normal</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convenience class for the normal distribution.</span>
<span class="sd">    packages up distribution parameters, seed and random generator.</span>

<span class="sd">    Use the minimum parameter to truncate the distribution</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">minimum</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        ------</span>
<span class="sd">        mean: float</span>
<span class="sd">            The mean of the normal distribution</span>
<span class="sd">            </span>
<span class="sd">        sigma: float</span>
<span class="sd">            The stdev of the normal distribution</span>
<span class="sd">            </span>
<span class="sd">        minimum: float, optional (default=None)</span>
<span class="sd">            Used to truncate the distribution (e.g. to 0.0 or 0.5)</span>
<span class="sd">        </span>
<span class="sd">        random_seed: int, optional (default=None)</span>
<span class="sd">            A random seed to reproduce samples.  If set to none then a unique</span>
<span class="sd">            sample is created.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mean</span> <span class="o">=</span> <span class="n">mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span> <span class="o">=</span> <span class="n">minimum</span>
        
    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate a sample from the normal distribution</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        size: int, optional (default=None)</span>
<span class="sd">            the number of samples to return.  If size=None then a single</span>
<span class="sd">            sample is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rng</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">samples</span>
        <span class="k">elif</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minimum</span><span class="p">,</span> <span class="n">samples</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># index of samples with negative value</span>
            <span class="n">neg_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">samples</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">neg_idx</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minimum</span>
            <span class="k">return</span> <span class="n">samples</span>

    
<span class="k">class</span> <span class="nc">Uniform</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Convenience class for the Uniform distribution.</span>
<span class="sd">    packages up distribution parameters, seed and random generator.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        ------</span>
<span class="sd">        low: float</span>
<span class="sd">            lower range of the uniform</span>
<span class="sd">            </span>
<span class="sd">        high: float</span>
<span class="sd">            upper range of the uniform</span>
<span class="sd">        </span>
<span class="sd">        random_seed: int, optional (default=None)</span>
<span class="sd">            A random seed to reproduce samples.  If set to none then a unique</span>
<span class="sd">            sample is created.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">low</span> <span class="o">=</span> <span class="n">low</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">high</span> <span class="o">=</span> <span class="n">high</span>
        
    <span class="k">def</span> <span class="nf">sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Generate a sample from the uniform distribution</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        size: int, optional (default=None)</span>
<span class="sd">            the number of samples to return.  If size=None then a single</span>
<span class="sd">            sample is returned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rand</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">high</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-parameterisation">
<h2>5. Model parameterisation<a class="headerlink" href="#model-parameterisation" title="Link to this heading">#</a></h2>
<p>For convienience a container class is used to hold the large number of model parameters.  The <code class="docutils literal notranslate"><span class="pre">Scenario</span></code> class includes defaults  these can easily be changed and at runtime to experiments with different designs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Scenario</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Container class for scenario parameters/arguments</span>
<span class="sd">    </span>
<span class="sd">    Passed to a model and its process classes</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_number_set</span><span class="o">=</span><span class="n">DEFAULT_RNG_SET</span><span class="p">,</span>
                 <span class="n">n_triage</span><span class="o">=</span><span class="n">DEFAULT_N_TRIAGE</span><span class="p">,</span>
                 <span class="n">n_reg</span><span class="o">=</span><span class="n">DEFAULT_N_REG</span><span class="p">,</span>
                 <span class="n">n_exam</span><span class="o">=</span><span class="n">DEFAULT_N_EXAM</span><span class="p">,</span>
                 <span class="n">n_trauma</span><span class="o">=</span><span class="n">DEFAULT_N_TRAUMA</span><span class="p">,</span>
                 <span class="n">n_cubicles_1</span><span class="o">=</span><span class="n">DEFAULT_N_CUBICLES_1</span><span class="p">,</span>
                 <span class="n">n_cubicles_2</span><span class="o">=</span><span class="n">DEFAULT_N_CUBICLES_2</span><span class="p">,</span>
                 <span class="n">triage_mean</span><span class="o">=</span><span class="n">DEFAULT_TRIAGE_MEAN</span><span class="p">,</span>
                 <span class="n">reg_mean</span><span class="o">=</span><span class="n">DEFAULT_REG_MEAN</span><span class="p">,</span>
                 <span class="n">reg_var</span><span class="o">=</span><span class="n">DEFAULT_REG_VAR</span><span class="p">,</span>
                 <span class="n">exam_mean</span><span class="o">=</span><span class="n">DEFAULT_EXAM_MEAN</span><span class="p">,</span>
                 <span class="n">exam_var</span><span class="o">=</span><span class="n">DEFAULT_EXAM_VAR</span><span class="p">,</span>
                 <span class="n">exam_min</span><span class="o">=</span><span class="n">DEFAULT_EXAM_MIN</span><span class="p">,</span>
                 <span class="n">trauma_mean</span><span class="o">=</span><span class="n">DEFAULT_TRAUMA_MEAN</span><span class="p">,</span>
                 <span class="n">trauma_treat_mean</span><span class="o">=</span><span class="n">DEFAULT_TRAUMA_TREAT_MEAN</span><span class="p">,</span>
                 <span class="n">trauma_treat_var</span><span class="o">=</span><span class="n">DEFAULT_TRAUMA_TREAT_VAR</span><span class="p">,</span>
                 <span class="n">non_trauma_treat_mean</span><span class="o">=</span><span class="n">DEFAULT_NON_TRAUMA_TREAT_MEAN</span><span class="p">,</span>
                 <span class="n">non_trauma_treat_var</span><span class="o">=</span><span class="n">DEFAULT_NON_TRAUMA_TREAT_VAR</span><span class="p">,</span>
                 <span class="n">non_trauma_treat_p</span><span class="o">=</span><span class="n">DEFAULT_NON_TRAUMA_TREAT_P</span><span class="p">,</span>
                 <span class="n">prob_trauma</span><span class="o">=</span><span class="n">DEFAULT_PROB_TRAUMA</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create a scenario to parameterise the simulation model</span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        -----------</span>
<span class="sd">        random_number_set: int, optional (default=DEFAULT_RNG_SET)</span>
<span class="sd">            Set to control the initial seeds of each stream of pseudo</span>
<span class="sd">            random numbers used in the model.</span>
<span class="sd">        </span>
<span class="sd">        n_triage: int</span>
<span class="sd">            The number of triage cubicles</span>
<span class="sd">        </span>
<span class="sd">        n_reg: int</span>
<span class="sd">            The number of registration clerks</span>
<span class="sd">            </span>
<span class="sd">        n_exam: int</span>
<span class="sd">            The number of examination rooms</span>
<span class="sd">            </span>
<span class="sd">        n_trauma: int</span>
<span class="sd">            The number of trauma bays for stabilisation</span>
<span class="sd">            </span>
<span class="sd">        n_cubicles_1: int</span>
<span class="sd">            The number of non-trauma treatment cubicles</span>
<span class="sd">            </span>
<span class="sd">        n_cubicles_2: int</span>
<span class="sd">            The number of trauma treatment cubicles</span>
<span class="sd">            </span>
<span class="sd">        triage_mean: float</span>
<span class="sd">            Mean duration of the triage distribution (Exponential)</span>
<span class="sd">            </span>
<span class="sd">        reg_mean: float</span>
<span class="sd">            Mean duration of the registration distribution (Lognormal)</span>
<span class="sd">            </span>
<span class="sd">        reg_var: float</span>
<span class="sd">            Variance of the registration distribution (Lognormal)</span>
<span class="sd">            </span>
<span class="sd">        exam_mean: float</span>
<span class="sd">            Mean of the examination distribution (Normal)</span>
<span class="sd">            </span>
<span class="sd">        exam_var: float</span>
<span class="sd">            Variance of the examination distribution (Normal)</span>

<span class="sd">        exam_min: float</span>
<span class="sd">            The minimum value that an examination can take (Truncated Normal)</span>
<span class="sd">            </span>
<span class="sd">        trauma_mean: float</span>
<span class="sd">            Mean of the trauma stabilisation distribution (Exponential)</span>
<span class="sd">            </span>
<span class="sd">        trauma_treat_mean: float</span>
<span class="sd">            Mean of the trauma cubicle treatment distribution (Lognormal)</span>
<span class="sd">            </span>
<span class="sd">        trauma_treat_var: float</span>
<span class="sd">            Variance of the trauma cubicle treatment distribution (Lognormal)</span>
<span class="sd">        </span>
<span class="sd">        non_trauma_treat_mean: float</span>
<span class="sd">            Mean of the non trauma treatment distribution</span>
<span class="sd">            </span>
<span class="sd">        non_trauma_treat_var: float</span>
<span class="sd">            Variance of the non trauma treatment distribution</span>
<span class="sd">        </span>
<span class="sd">        non_trauma_treat_p: float</span>
<span class="sd">            Probability non trauma patient requires treatment</span>
<span class="sd">            </span>
<span class="sd">        prob_trauma: float</span>
<span class="sd">            probability that a new arrival is a trauma patient.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># sampling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_number_set</span> <span class="o">=</span> <span class="n">random_number_set</span>
        
        <span class="c1"># store parameters for sampling</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triage_mean</span> <span class="o">=</span> <span class="n">triage_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_mean</span> <span class="o">=</span> <span class="n">reg_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_var</span> <span class="o">=</span> <span class="n">reg_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exam_mean</span><span class="o">=</span> <span class="n">exam_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exam_var</span> <span class="o">=</span> <span class="n">exam_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exam_min</span> <span class="o">=</span> <span class="n">exam_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_mean</span> <span class="o">=</span> <span class="n">trauma_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_treat_mean</span> <span class="o">=</span> <span class="n">trauma_treat_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_treat_var</span> <span class="o">=</span> <span class="n">trauma_treat_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_mean</span> <span class="o">=</span> <span class="n">non_trauma_treat_mean</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_var</span> <span class="o">=</span> <span class="n">non_trauma_treat_var</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_p</span> <span class="o">=</span> <span class="n">non_trauma_treat_p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prob_trauma</span> <span class="o">=</span> <span class="n">prob_trauma</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">init_sampling</span><span class="p">()</span>
        
        <span class="c1"># count of each type of resource</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_resourse_counts</span><span class="p">(</span><span class="n">n_triage</span><span class="p">,</span> <span class="n">n_reg</span><span class="p">,</span> <span class="n">n_exam</span><span class="p">,</span> <span class="n">n_trauma</span><span class="p">,</span>
                                  <span class="n">n_cubicles_1</span><span class="p">,</span> <span class="n">n_cubicles_2</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">set_random_no_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">random_number_set</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Controls the random sampling </span>
<span class="sd">        Parameters:</span>
<span class="sd">        ----------</span>
<span class="sd">        random_number_set: int</span>
<span class="sd">            Used to control the set of pseudo random numbers</span>
<span class="sd">            used by the distributions in the simulation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_number_set</span> <span class="o">=</span> <span class="n">random_number_set</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_sampling</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">init_resourse_counts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_triage</span><span class="p">,</span> <span class="n">n_reg</span><span class="p">,</span> <span class="n">n_exam</span><span class="p">,</span> <span class="n">n_trauma</span><span class="p">,</span>
                             <span class="n">n_cubicles_1</span><span class="p">,</span> <span class="n">n_cubicles_2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Init the counts of resources to default values...</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_triage</span> <span class="o">=</span> <span class="n">n_triage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_reg</span> <span class="o">=</span> <span class="n">n_reg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_exam</span> <span class="o">=</span> <span class="n">n_exam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_trauma</span> <span class="o">=</span> <span class="n">n_trauma</span>
        
        <span class="c1"># non-trauma (1), trauma (2) treatment cubicles</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cubicles_1</span> <span class="o">=</span> <span class="n">n_cubicles_1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cubicles_2</span> <span class="o">=</span> <span class="n">n_cubicles_2</span>

    <span class="k">def</span> <span class="nf">init_sampling</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Create the distributions used by the model and initialise </span>
<span class="sd">        the random seeds of each.</span>
<span class="sd">        &#39;&#39;&#39;</span>       
        <span class="c1"># MODIFICATION. Better method for producing n non-overlapping streams</span>
        <span class="n">seed_sequence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">SeedSequence</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">random_number_set</span><span class="p">)</span>
    
        <span class="c1"># Generate n high quality child seeds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seeds</span> <span class="o">=</span> <span class="n">seed_sequence</span><span class="o">.</span><span class="n">spawn</span><span class="p">(</span><span class="n">N_STREAMS</span><span class="p">)</span>
        
        <span class="c1"># create distributions</span>
        
        <span class="c1"># Triage duration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triage_dist</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">triage_mean</span><span class="p">,</span> 
                                       <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c1"># Registration duration (non-trauma only)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_dist</span> <span class="o">=</span> <span class="n">Lognormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_mean</span><span class="p">,</span> 
                                  <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_var</span><span class="p">),</span>
                                  <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># Evaluation (non-trauma only)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exam_dist</span> <span class="o">=</span> <span class="n">Normal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exam_mean</span><span class="p">,</span>
                                <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exam_var</span><span class="p">),</span>
                                <span class="n">minimum</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exam_min</span><span class="p">,</span>
                                <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        
        <span class="c1"># Trauma/stablisation duration (trauma only)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_dist</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trauma_mean</span><span class="p">,</span> 
                                       <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        
        <span class="c1"># Non-trauma treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nt_treat_dist</span> <span class="o">=</span> <span class="n">Lognormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_mean</span><span class="p">,</span> 
                                       <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_var</span><span class="p">),</span>
                                       <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        
        <span class="c1"># treatment of trauma patients</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treat_dist</span> <span class="o">=</span> <span class="n">Lognormal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trauma_treat_mean</span><span class="p">,</span> 
                                    <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trauma_treat_var</span><span class="p">),</span>
                                    <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        
        <span class="c1"># probability of non-trauma patient requiring treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nt_p_treat_dist</span> <span class="o">=</span> <span class="n">Bernoulli</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_treat_p</span><span class="p">,</span> 
                                         <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span>
        
        
        <span class="c1"># probability of non-trauma versus trauma patient</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p_trauma_dist</span> <span class="o">=</span> <span class="n">Bernoulli</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prob_trauma</span><span class="p">,</span> 
                                       <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>
        
        <span class="c1"># init sampling for non-stationary poisson process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_nspp</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">init_nspp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1"># read arrival profile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrivals</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">NSPP_PATH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrivals</span><span class="p">[</span><span class="s1">&#39;mean_iat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">60</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrivals</span><span class="p">[</span><span class="s1">&#39;arrival_rate&#39;</span><span class="p">]</span>
       
        <span class="c1"># maximum arrival rate (smallest time between arrivals)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lambda_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrivals</span><span class="p">[</span><span class="s1">&#39;arrival_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        
        <span class="c1"># thinning exponential</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrival_dist</span> <span class="o">=</span> <span class="n">Exponential</span><span class="p">(</span><span class="mf">60.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lambda_max</span><span class="p">,</span>
                                        <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
        
        <span class="c1"># thinning uniform rng</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thinning_rng</span> <span class="o">=</span> <span class="n">Uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> 
                                    <span class="n">random_seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">seeds</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="patient-pathways-process-logic">
<h2>6. Patient Pathways Process Logic<a class="headerlink" href="#patient-pathways-process-logic" title="Link to this heading">#</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">simpy</span></code> uses a process based worldview.  We can easily create whatever logic - simple or complex  for the model.  Here the process logic for trauma and non-trauma patients is seperated into two classes <code class="docutils literal notranslate"><span class="pre">TraumaPathway</span></code>  and <code class="docutils literal notranslate"><span class="pre">NonTraumaPathway</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TraumaPathway</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Encapsulates the process a patient with severe injuries or illness.</span>
<span class="sd">    </span>
<span class="sd">    These patients are signed into the ED and triaged as having severe injuries</span>
<span class="sd">    or illness.</span>
<span class="sd">    </span>
<span class="sd">    Patients are stabilised in resus (trauma) and then sent to Treatment.  </span>
<span class="sd">    Following treatment they are discharged.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor method</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -----</span>
<span class="sd">        identifier: int</span>
<span class="sd">            a numeric identifier for the patient.</span>
<span class="sd">            </span>
<span class="sd">        env: simpy.Environment</span>
<span class="sd">            the simulation environment</span>
<span class="sd">            </span>
<span class="sd">        args: Scenario</span>
<span class="sd">            Container class for the simulation parameters</span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        
        <span class="c1"># metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_trauma</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        simulates the major treatment process for a patient</span>
<span class="sd">        </span>
<span class="sd">        1. request and wait for sign-in/triage</span>
<span class="sd">        2. trauma</span>
<span class="sd">        3. treatment</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># record the time of arrival and entered the triage queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>

        <span class="c1"># request sign-in/triage </span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">triage</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            <span class="c1"># record the waiting time for triage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span>     
            
            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> triaged to trauma &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        
            <span class="c1"># sample triage duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">triage_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">triage_complete</span><span class="p">()</span>
            
        <span class="c1"># record the time that entered the trauma queue</span>
        <span class="n">start_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
    
        <span class="c1"># request trauma room </span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">trauma</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            
            <span class="c1"># record the waiting time for trauma</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_trauma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_wait</span>
            
            <span class="c1"># sample stablisation duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trauma_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">trauma_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trauma_duration</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">trauma_complete</span><span class="p">()</span>
            
        <span class="c1"># record the time that entered the treatment queue</span>
        <span class="n">start_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
    
        <span class="c1"># request treatment cubicle </span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">cubicle_2</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            
            <span class="c1"># record the waiting time for trauma</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_wait</span>
            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;treatment of patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> at &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="c1"># sample treatment duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">treat_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">treatment_complete</span><span class="p">()</span>
        
        <span class="c1"># total time in system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span>     
            
    <span class="k">def</span> <span class="nf">triage_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Triage complete event</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;triage </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> complete </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">; &#39;</span>
              <span class="sa">f</span><span class="s1">&#39;waiting time was </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
          
    <span class="k">def</span> <span class="nf">trauma_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Patient stay in trauma is complete.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;stabilisation of patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> at &#39;</span>
              <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">treatment_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Treatment complete event</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> treatment complete </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">; &#39;</span>
        <span class="sa">f</span><span class="s1">&#39;waiting time was </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">NonTraumaPathway</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Encapsulates the process a patient with minor injuries and illness.</span>
<span class="sd">    </span>
<span class="sd">    These patients are signed into the ED and triaged as having minor </span>
<span class="sd">    complaints and streamed to registration and then examination. </span>
<span class="sd">    </span>
<span class="sd">    Post examination 40% are discharged while 60% proceed to treatment.  </span>
<span class="sd">    Following treatment they are discharged.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor method</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -----</span>
<span class="sd">        identifier: int</span>
<span class="sd">            a numeric identifier for the patient.</span>
<span class="sd">            </span>
<span class="sd">        env: simpy.Environment</span>
<span class="sd">            the simulation environment</span>
<span class="sd">            </span>
<span class="sd">        args: Scenario</span>
<span class="sd">            Container class for the simulation parameters</span>
<span class="sd">            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identifier</span> <span class="o">=</span> <span class="n">identifier</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        
        <span class="c1"># triage resource</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">triage</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">triage</span>
        
        <span class="c1"># metrics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_reg</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_exam</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reg_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exam_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        
        
    <span class="k">def</span> <span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        simulates the non-trauma/minor treatment process for a patient</span>
<span class="sd">        </span>
<span class="sd">        1. request and wait for sign-in/triage</span>
<span class="sd">        2. patient registration</span>
<span class="sd">        3. examination</span>
<span class="sd">        4.1 40% discharged</span>
<span class="sd">        4.2 60% treatment then discharge</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># record the time of arrival and entered the triage queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>

        <span class="c1"># request sign-in/triage </span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">triage</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            
            <span class="c1"># record the waiting time for triage</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span>
            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> triaged to minors &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="c1"># sample triage duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">triage_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">triage_duration</span><span class="p">)</span>
            
            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;triage </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> complete </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">; &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;waiting time was </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_triage</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="c1"># record the time that entered the registration queue</span>
        <span class="n">start_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
    
        <span class="c1"># request registration clert </span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">registration</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            
            <span class="c1"># record the waiting time for registration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_reg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_wait</span>
            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;registration of patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> at &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="c1"># sample registration duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reg_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">reg_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">reg_duration</span><span class="p">)</span>
            
            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> registered at&#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">; &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;waiting time was </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_reg</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="c1"># record the time that entered the evaluation queue</span>
        <span class="n">start_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
    
        <span class="c1"># request examination resource</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">exam</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">req</span>
            
            <span class="c1"># record the waiting time for registration</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wait_exam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_wait</span>
            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;examination of patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> begins &#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="c1"># sample examination duration.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">exam_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">exam_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exam_duration</span><span class="p">)</span>
            
            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> examination complete &#39;</span> 
                  <span class="sa">f</span><span class="s1">&#39;at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">;&#39;</span>
                  <span class="sa">f</span><span class="s1">&#39;waiting time was </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_exam</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
        <span class="c1"># sample if patient requires treatment?</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">require_treat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nt_p_treat_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">require_treat</span><span class="p">:</span>
        
            <span class="c1"># record the time that entered the treatment queue</span>
            <span class="n">start_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span>
    
            <span class="c1"># request treatment cubicle</span>
            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">cubicle_1</span><span class="o">.</span><span class="n">request</span><span class="p">()</span> <span class="k">as</span> <span class="n">req</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">req</span>

                <span class="c1"># record the waiting time for treatment</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="n">start_wait</span>
                <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;treatment of patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> begins &#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="c1"># sample treatment duration.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">nt_treat_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">treat_duration</span><span class="p">)</span>

                <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;patient </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">identifier</span><span class="si">}</span><span class="s1"> treatment complete &#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;at </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">;&#39;</span>
                      <span class="sa">f</span><span class="s1">&#39;waiting time was </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">wait_treat</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                
        <span class="c1"># total time in system</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">arrival</span>      
</pre></div>
</div>
</div>
</div>
</section>
<section id="main-model-class">
<h2>7. Main model class<a class="headerlink" href="#main-model-class" title="Link to this heading">#</a></h2>
<p>The main class that a user interacts with to run the model is <code class="docutils literal notranslate"><span class="pre">TreatmentCentreModel</span></code>.  This implements a <code class="docutils literal notranslate"><span class="pre">.run()</span></code> method, contains a simple algorithm for the non-stationary poission process for patients arrivals and inits instances of <code class="docutils literal notranslate"><span class="pre">TraumaPathway</span></code> or <code class="docutils literal notranslate"><span class="pre">NonTraumaPathway</span></code> depending on the arrival type.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TreatmentCentreModel</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The treatment centre model</span>
<span class="sd">    </span>
<span class="sd">    Patients arrive at random to a treatment centre, are triaged</span>
<span class="sd">    and then processed in either a trauma or non-trauma pathway.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Environment</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_resources</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">patients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trauma_patients</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_patients</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rc_period</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">init_resources</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Init the number of resources</span>
<span class="sd">        and store in the arguments container object</span>
<span class="sd">        </span>
<span class="sd">        Resource list:</span>
<span class="sd">        1. Sign-in/triage bays</span>
<span class="sd">        2. registration clerks</span>
<span class="sd">        3. examination bays</span>
<span class="sd">        4. trauma bays</span>
<span class="sd">        5. non-trauma cubicles (1)</span>
<span class="sd">        6. trauma cubicles (2)</span>
<span class="sd">         </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># sign/in triage</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">triage</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                          <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_triage</span><span class="p">)</span>
        
        <span class="c1"># registration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">registration</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                                <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_reg</span><span class="p">)</span>
        
        <span class="c1"># examination</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">exam</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                        <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_exam</span><span class="p">)</span>
        
        <span class="c1"># trauma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">trauma</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                          <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_trauma</span><span class="p">)</span>
        
        <span class="c1"># non-trauma treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">cubicle_1</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                              <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_cubicles_1</span><span class="p">)</span>
            
        <span class="c1"># trauma treatment</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">cubicle_2</span> <span class="o">=</span> <span class="n">simpy</span><span class="o">.</span><span class="n">Resource</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                              <span class="n">capacity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_cubicles_2</span><span class="p">)</span>
        
        
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results_collection_period</span><span class="o">=</span><span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Conduct a single run of the model in its current </span>
<span class="sd">        configuration</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        Parameters:</span>
<span class="sd">        ----------</span>
<span class="sd">        results_collection_period, float, optional</span>
<span class="sd">            default = DEFAULT_RESULTS_COLLECTION_PERIOD</span>
<span class="sd">            </span>
<span class="sd">        warm_up, float, optional (default=0)</span>
<span class="sd">        </span>
<span class="sd">            length of initial transient period to truncate</span>
<span class="sd">            from results.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">        --------</span>
<span class="sd">            None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># setup the arrival generator process</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arrivals_generator</span><span class="p">())</span>
        
        <span class="c1"># store rc perio</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rc_period</span> <span class="o">=</span> <span class="n">results_collection_period</span>
        
        <span class="c1"># run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">until</span><span class="o">=</span><span class="n">results_collection_period</span><span class="p">)</span>
        
    
    <span class="k">def</span> <span class="nf">arrivals_generator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
<span class="w">        </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Simulate the arrival of patients to the model</span>
<span class="sd">        </span>
<span class="sd">        Patients either follow a TraumaPathway or</span>
<span class="sd">        NonTraumaPathway simpy process.</span>
<span class="sd">        </span>
<span class="sd">        Non stationary arrivals implemented via Thinning acceptance-rejection </span>
<span class="sd">        algorithm.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">patient_count</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">count</span><span class="p">():</span>

            <span class="c1"># this give us the index of dataframe to use</span>
            <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span> <span class="o">//</span> <span class="mi">60</span><span class="p">)</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">arrivals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">lambda_t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">arrivals</span><span class="p">[</span><span class="s1">&#39;arrival_rate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>

            <span class="c1">#set to a large number so that at least 1 sample taken!</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">Inf</span>
            
            <span class="n">interarrival_time</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="c1"># reject samples if u &gt;= lambda_t / lambda_max</span>
            <span class="k">while</span> <span class="n">u</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">lambda_t</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">lambda_max</span><span class="p">):</span>
                <span class="n">interarrival_time</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">arrival_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
                <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">thinning_rng</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>

            <span class="c1"># iat</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">timeout</span><span class="p">(</span><span class="n">interarrival_time</span><span class="p">)</span>
            
            <span class="n">trace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;patient </span><span class="si">{</span><span class="n">patient_count</span><span class="si">}</span><span class="s1"> arrives at: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">now</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            
            <span class="c1"># sample if the patient is trauma or non-trauma</span>
            <span class="n">trauma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">p_trauma_dist</span><span class="o">.</span><span class="n">sample</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">trauma</span><span class="p">:</span>
                <span class="c1"># create and store a trauma patient to update KPIs.</span>
                <span class="n">new_patient</span> <span class="o">=</span> <span class="n">TraumaPathway</span><span class="p">(</span><span class="n">patient_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trauma_patients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_patient</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># create and store a non-trauma patient to update KPIs.</span>
                <span class="n">new_patient</span> <span class="o">=</span> <span class="n">NonTraumaPathway</span><span class="p">(</span><span class="n">patient_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span> 
                                               <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_patient</span><span class="p">)</span>
                
            <span class="c1"># start the pathway process for the patient</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">new_patient</span><span class="o">.</span><span class="n">execute</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<section id="logic-to-process-end-of-run-results">
<h3>8. Logic to process end of run results.<a class="headerlink" href="#logic-to-process-end-of-run-results" title="Link to this heading">#</a></h3>
<p>the class <code class="docutils literal notranslate"><span class="pre">SimulationSummary</span></code> accepts a <code class="docutils literal notranslate"><span class="pre">TraumaCentreModel</span></code>.  At the end of a run it can be used calculate mean queuing times and the percentage of the total run that a resource was in use.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SimulationSummary</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    End of run result processing logic of the simulation model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Constructor</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        ------</span>
<span class="sd">        model: TraumaCentreModel</span>
<span class="sd">            The model.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="kc">None</span>
    
    <span class="k">def</span> <span class="nf">process_run_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculates statistics at end of run.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1"># list of all patients </span>
        <span class="n">patients</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span>
        
        <span class="c1"># mean triage times (both types of patient)</span>
        <span class="n">mean_triage_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_triage&#39;</span><span class="p">,</span> <span class="n">patients</span><span class="p">)</span>
        
        <span class="c1"># triage utilisation (both types of patient)</span>
        <span class="n">triage_util</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;triage_duration&#39;</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_triage</span><span class="p">,</span> 
                                             <span class="n">patients</span><span class="p">)</span>
        
        <span class="c1"># mean waiting time for registration (non_trauma)</span>
        <span class="n">mean_reg_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_reg&#39;</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># registration utilisation (trauma)</span>
        <span class="n">reg_util</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;reg_duration&#39;</span><span class="p">,</span> 
                                          <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_reg</span><span class="p">,</span> 
                                          <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># mean waiting time for examination (non_trauma)</span>
        <span class="n">mean_wait_exam</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_exam&#39;</span><span class="p">,</span> 
                                              <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># examination utilisation (non-trauma)</span>
        <span class="n">exam_util</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;exam_duration&#39;</span><span class="p">,</span> 
                                            <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_exam</span><span class="p">,</span> 
                                            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        
        <span class="c1"># mean waiting time for treatment (non-trauma) </span>
        <span class="n">mean_treat_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_treat&#39;</span><span class="p">,</span> 
                                               <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># treatment utilisation (non_trauma)</span>
        <span class="n">treat_util1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;treat_duration&#39;</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_cubicles_1</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># mean total time (non_trauma)</span>
        <span class="n">mean_total</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;total_time&#39;</span><span class="p">,</span> 
                                          <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">non_trauma_patients</span><span class="p">)</span>
                                    
        <span class="c1"># mean waiting time for trauma </span>
        <span class="n">mean_trauma_wait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_trauma&#39;</span><span class="p">,</span> 
                                                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># trauma utilisation (trauma)</span>
        <span class="n">trauma_util</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;trauma_duration&#39;</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_trauma</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># mean waiting time for treatment (rauma) </span>
        <span class="n">mean_treat_wait2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;wait_treat&#39;</span><span class="p">,</span> 
                                                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span><span class="p">)</span>
        
        <span class="c1"># treatment utilisation (trauma)</span>
        <span class="n">treat_util2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_resource_util</span><span class="p">(</span><span class="s1">&#39;treat_duration&#39;</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">n_cubicles_2</span><span class="p">,</span> 
                                             <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span><span class="p">)</span>

        <span class="c1"># mean total time (trauma)</span>
        <span class="n">mean_total2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mean_metric</span><span class="p">(</span><span class="s1">&#39;total_time&#39;</span><span class="p">,</span> 
                                           <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">trauma_patients</span><span class="p">)</span>
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;00_arrivals&#39;</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">patients</span><span class="p">),</span>
                        <span class="s1">&#39;01a_triage_wait&#39;</span><span class="p">:</span> <span class="n">mean_triage_wait</span><span class="p">,</span>
                        <span class="s1">&#39;01b_triage_util&#39;</span><span class="p">:</span> <span class="n">triage_util</span><span class="p">,</span>
                        <span class="s1">&#39;02a_registration_wait&#39;</span><span class="p">:</span><span class="n">mean_reg_wait</span><span class="p">,</span>
                        <span class="s1">&#39;02b_registration_util&#39;</span><span class="p">:</span> <span class="n">reg_util</span><span class="p">,</span>
                        <span class="s1">&#39;03a_examination_wait&#39;</span><span class="p">:</span><span class="n">mean_wait_exam</span><span class="p">,</span>
                        <span class="s1">&#39;03b_examination_util&#39;</span><span class="p">:</span> <span class="n">exam_util</span><span class="p">,</span>
                        <span class="s1">&#39;04a_treatment_wait(non_trauma)&#39;</span><span class="p">:</span><span class="n">mean_treat_wait</span><span class="p">,</span>
                        <span class="s1">&#39;04b_treatment_util(non_trauma)&#39;</span><span class="p">:</span><span class="n">treat_util1</span><span class="p">,</span>
                        <span class="s1">&#39;05_total_time(non-trauma)&#39;</span><span class="p">:</span><span class="n">mean_total</span><span class="p">,</span>
                        <span class="s1">&#39;06a_trauma_wait&#39;</span><span class="p">:</span><span class="n">mean_trauma_wait</span><span class="p">,</span>
                        <span class="s1">&#39;06b_trauma_util&#39;</span><span class="p">:</span><span class="n">trauma_util</span><span class="p">,</span>
                        <span class="s1">&#39;07a_treatment_wait(trauma)&#39;</span><span class="p">:</span><span class="n">mean_treat_wait2</span><span class="p">,</span>
                        <span class="s1">&#39;07b_treatment_util(trauma)&#39;</span><span class="p">:</span><span class="n">treat_util2</span><span class="p">,</span>
                        <span class="s1">&#39;08_total_time(trauma)&#39;</span><span class="p">:</span><span class="n">mean_total2</span><span class="p">,</span>
                        <span class="s1">&#39;09_throughput&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_throughput</span><span class="p">(</span><span class="n">patients</span><span class="p">)}</span>
        
    <span class="k">def</span> <span class="nf">get_mean_metric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">patients</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate mean of the performance measure for the</span>
<span class="sd">        select cohort of patients,</span>
<span class="sd">        </span>
<span class="sd">        Only calculates metrics for patients where it has been </span>
<span class="sd">        measured.</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        metric: str</span>
<span class="sd">            The name of the metric e.g. &#39;wait_treat&#39;</span>
<span class="sd">            </span>
<span class="sd">        patients: list</span>
<span class="sd">            A list of patients</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patients</span> 
                         <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mean</span>
    
    
    <span class="k">def</span> <span class="nf">get_resource_util</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">metric</span><span class="p">,</span> <span class="n">n_resources</span><span class="p">,</span> <span class="n">patients</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Calculate proportion of the results collection period</span>
<span class="sd">        where a resource was in use.</span>
<span class="sd">        </span>
<span class="sd">        Done by tracking the duration by patient.</span>
<span class="sd">        </span>
<span class="sd">        Only calculates metrics for patients where it has been </span>
<span class="sd">        measured.</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        metric: str</span>
<span class="sd">            The name of the metric e.g. &#39;treatment_duration&#39;</span>
<span class="sd">            </span>
<span class="sd">        patients: list</span>
<span class="sd">            A list of patients</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patients</span> 
                         <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">metric</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> 
        
        <span class="k">return</span> <span class="n">total</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">rc_period</span> <span class="o">*</span> <span class="n">n_resources</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">get_throughput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patients</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the total number of patients that have successfully</span>
<span class="sd">        been processed and discharged in the treatment centre</span>
<span class="sd">        (they have a total time record)</span>
<span class="sd">        </span>
<span class="sd">        Params:</span>
<span class="sd">        -------</span>
<span class="sd">        patients: list</span>
<span class="sd">            list of all patient objects simulated.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        ------</span>
<span class="sd">        float</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">([</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">patients</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">total_time</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">])</span>
    
    <span class="k">def</span> <span class="nf">summary_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns run results as a pandas.DataFrame</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">        -------</span>
<span class="sd">        pd.DataFrame</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#append to results df</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">process_run_results</span><span class="p">()</span>

        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;1&#39;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">})</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">T</span>
        <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;rep&#39;</span>
        <span class="k">return</span> <span class="n">df</span>
    
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="model-execution">
<h2>9. Model execution<a class="headerlink" href="#model-execution" title="Link to this heading">#</a></h2>
<p>We note that there are <strong>many ways</strong> to setup a <code class="docutils literal notranslate"><span class="pre">simpy</span></code> model and execute it (that is part of its fantastic flexibility).  The organisation of code we show below is based on our experience of using the package in practice. The approach also allows for easy parallisation over multiple CPU cores using <code class="docutils literal notranslate"><span class="pre">joblib</span></code>.</p>
<p>We include two functions. <code class="docutils literal notranslate"><span class="pre">single_run()</span></code> and <code class="docutils literal notranslate"><span class="pre">multiple_replications</span></code>.  The latter is used to repeatedly call and process the results from <code class="docutils literal notranslate"><span class="pre">single_run</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">single_run</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">rc_period</span><span class="o">=</span><span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span><span class="p">,</span> 
               <span class="n">random_no_set</span><span class="o">=</span><span class="n">DEFAULT_RNG_SET</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Perform a single run of the model and return the results</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    </span>
<span class="sd">    scenario: Scenario object</span>
<span class="sd">        The scenario/paramaters to run</span>
<span class="sd">        </span>
<span class="sd">    rc_period: int</span>
<span class="sd">        The length of the simulation run that collects results</span>
<span class="sd">        </span>
<span class="sd">    random_no_set: int or None, optional (default=DEFAULT_RNG_SET)</span>
<span class="sd">        Controls the set of random seeds used by the stochastic parts of the </span>
<span class="sd">        model.  Set to different ints to get different results.  Set to None</span>
<span class="sd">        for a random set of seeds.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">        pandas.DataFrame:</span>
<span class="sd">        results from single run.</span>
<span class="sd">    &#39;&#39;&#39;</span>  
        
    <span class="c1"># set random number set - this controls sampling for the run.</span>
    <span class="n">scenario</span><span class="o">.</span><span class="n">set_random_no_set</span><span class="p">(</span><span class="n">random_no_set</span><span class="p">)</span>

    <span class="c1"># create an instance of the model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">TreatmentCentreModel</span><span class="p">(</span><span class="n">scenario</span><span class="p">)</span>

    <span class="c1"># run the model</span>
    <span class="n">model</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">results_collection_period</span><span class="o">=</span><span class="n">rc_period</span><span class="p">)</span>
        
    <span class="c1"># run results</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">SimulationSummary</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
    <span class="n">summary_df</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">summary_frame</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="n">summary_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">multiple_replications</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">rc_period</span><span class="o">=</span><span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span><span class="p">,</span> 
                          <span class="n">n_reps</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Perform multiple replications of the model.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    scenario: Scenario</span>
<span class="sd">        Parameters/arguments to configurethe model</span>
<span class="sd">    </span>
<span class="sd">    rc_period: float, optional (default=DEFAULT_RESULTS_COLLECTION_PERIOD)</span>
<span class="sd">        results collection period.  </span>
<span class="sd">        the number of minutes to run the model to collect results</span>

<span class="sd">    n_reps: int, optional (default=DEFAULT_N_REPS)</span>
<span class="sd">        Number of independent replications to run.</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    pandas.DataFrame</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">single_run</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">rc_period</span><span class="p">,</span> <span class="n">random_no_set</span><span class="o">=</span><span class="n">rep</span><span class="p">)</span> 
               <span class="k">for</span> <span class="n">rep</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_reps</span><span class="p">)]</span>
    
    <span class="c1">#format and return results in a dataframe</span>
    <span class="n">df_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">df_results</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_results</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">df_results</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;rep&#39;</span>
    <span class="k">return</span> <span class="n">df_results</span>
</pre></div>
</div>
</div>
</div>
<section id="single-run-of-the-model">
<h3>9.1 Single run of the model<a class="headerlink" href="#single-run-of-the-model" title="Link to this heading">#</a></h3>
<p>The script below performs a single replication of the simulation model.</p>
<p><strong>Try:</strong></p>
<ul class="simple">
<li><p>Changing the <code class="docutils literal notranslate"><span class="pre">random_no_set</span></code> of the <code class="docutils literal notranslate"><span class="pre">single_run</span></code> call.</p></li>
<li><p>Assigning the value <code class="docutils literal notranslate"><span class="pre">True</span></code> to <code class="docutils literal notranslate"><span class="pre">TRACE</span></code></p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change this to True to see a trace...</span>
<span class="n">TRACE</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># create the default scenario</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">()</span>

<span class="c1"># use the single_run() func</span>
<span class="c1"># try changing `random_no_set` to see different run results</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running simulation ...&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; =&gt; &#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">single_run</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">random_no_set</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;simulation complete.&#39;</span><span class="p">)</span>

<span class="c1"># show results (transpose replication for easier view)</span>
<span class="n">results</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running simulation ... =&gt; simulation complete.
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>rep</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>00_arrivals</th>
      <td>209.000000</td>
    </tr>
    <tr>
      <th>01a_triage_wait</th>
      <td>16.622674</td>
    </tr>
    <tr>
      <th>01b_triage_util</th>
      <td>0.527512</td>
    </tr>
    <tr>
      <th>02a_registration_wait</th>
      <td>111.161345</td>
    </tr>
    <tr>
      <th>02b_registration_util</th>
      <td>0.801061</td>
    </tr>
    <tr>
      <th>03a_examination_wait</th>
      <td>24.927965</td>
    </tr>
    <tr>
      <th>03b_examination_util</th>
      <td>0.851285</td>
    </tr>
    <tr>
      <th>04a_treatment_wait(non_trauma)</th>
      <td>172.435861</td>
    </tr>
    <tr>
      <th>04b_treatment_util(non_trauma)</th>
      <td>0.845652</td>
    </tr>
    <tr>
      <th>05_total_time(non-trauma)</th>
      <td>248.848441</td>
    </tr>
    <tr>
      <th>06a_trauma_wait</th>
      <td>201.144403</td>
    </tr>
    <tr>
      <th>06b_trauma_util</th>
      <td>0.919830</td>
    </tr>
    <tr>
      <th>07a_treatment_wait(trauma)</th>
      <td>22.620880</td>
    </tr>
    <tr>
      <th>07b_treatment_util(trauma)</th>
      <td>0.493576</td>
    </tr>
    <tr>
      <th>08_total_time(trauma)</th>
      <td>310.384648</td>
    </tr>
    <tr>
      <th>09_throughput</th>
      <td>155.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="multiple-independent-replications">
<h3>9.2 Multiple independent replications<a class="headerlink" href="#multiple-independent-replications" title="Link to this heading">#</a></h3>
<p>Given the set up it is now easy to perform multiple replications of the model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>
<span class="n">args</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">()</span>

<span class="c1">#run multiple replications.</span>
<span class="c1">#by default it runs 5 replications.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running multiple replications&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; =&gt; &#39;</span><span class="p">)</span>
<span class="n">results</span>  <span class="o">=</span> <span class="n">multiple_replications</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">n_reps</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">results</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running multiple replications =&gt; 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>done.

CPU times: user 2.48 s, sys: 19.6 ms, total: 2.5 s
Wall time: 3.83 s
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>00_arrivals</th>
      <th>01a_triage_wait</th>
      <th>01b_triage_util</th>
      <th>02a_registration_wait</th>
      <th>02b_registration_util</th>
      <th>03a_examination_wait</th>
      <th>03b_examination_util</th>
      <th>04a_treatment_wait(non_trauma)</th>
      <th>04b_treatment_util(non_trauma)</th>
      <th>05_total_time(non-trauma)</th>
      <th>06a_trauma_wait</th>
      <th>06b_trauma_util</th>
      <th>07a_treatment_wait(trauma)</th>
      <th>07b_treatment_util(trauma)</th>
      <th>08_total_time(trauma)</th>
      <th>09_throughput</th>
    </tr>
    <tr>
      <th>rep</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>230.0</td>
      <td>24.280943</td>
      <td>0.613250</td>
      <td>103.242292</td>
      <td>0.854504</td>
      <td>31.089680</td>
      <td>0.861719</td>
      <td>152.483394</td>
      <td>0.890904</td>
      <td>234.759918</td>
      <td>236.508444</td>
      <td>1.028887</td>
      <td>13.701783</td>
      <td>0.607996</td>
      <td>346.698079</td>
      <td>171.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>227.0</td>
      <td>57.120114</td>
      <td>0.621348</td>
      <td>90.002385</td>
      <td>0.836685</td>
      <td>14.688492</td>
      <td>0.847295</td>
      <td>120.245474</td>
      <td>0.912127</td>
      <td>233.882040</td>
      <td>133.813901</td>
      <td>0.834124</td>
      <td>3.715446</td>
      <td>0.367507</td>
      <td>301.521195</td>
      <td>161.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>229.0</td>
      <td>28.659383</td>
      <td>0.573698</td>
      <td>112.242503</td>
      <td>0.848514</td>
      <td>21.374092</td>
      <td>0.856306</td>
      <td>94.019885</td>
      <td>0.868888</td>
      <td>208.361290</td>
      <td>276.422566</td>
      <td>0.874245</td>
      <td>12.252175</td>
      <td>0.464740</td>
      <td>440.515502</td>
      <td>167.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># summarise the results (2.dp)</span>
<span class="n">results</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>00_arrivals                       227.72
01a_triage_wait                    35.24
01b_triage_util                     0.61
02a_registration_wait             105.57
02b_registration_util               0.84
03a_examination_wait               25.55
03b_examination_util                0.85
04a_treatment_wait(non_trauma)    136.66
04b_treatment_util(non_trauma)      0.87
05_total_time(non-trauma)         234.34
06a_trauma_wait                   151.68
06b_trauma_util                     0.83
07a_treatment_wait(trauma)         14.31
07b_treatment_util(trauma)          0.50
08_total_time(trauma)             292.28
09_throughput                     162.16
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="visualise-replications">
<h3>9.3 Visualise replications<a class="headerlink" href="#visualise-replications" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;01a_triage_wait&#39;</span><span class="p">]);</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;wait for triage&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;02a_registration_wait&#39;</span><span class="p">]);</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;wait for registration&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/f5fe031021211fd6158e17f67c6445a4b0ae50d0be356499ee3c32321f31b7f6.png" src="../../_images/f5fe031021211fd6158e17f67c6445a4b0ae50d0be356499ee3c32321f31b7f6.png" />
</div>
</div>
<p>## 10. Scenario Analysis</p>
<p>The structured approach we took to organising our <code class="docutils literal notranslate"><span class="pre">simpy</span></code> model allows us to easily experiment with alternative scenarios.  We could employ a formal experimental design if needed.  For simplicity here we will limit ourselves by running user chosen competing scenarios and compare their mean performance to the base case.</p>
<blockquote>
<div><p>Note that we have our <code class="docutils literal notranslate"><span class="pre">simpy</span></code> model includes an implementation of <strong>Common Random Numbers</strong> across scenarios.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_scenarios</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates a dictionary object containing</span>
<span class="sd">    objects of type `Scenario` to run.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict</span>
<span class="sd">        Contains the scenarios for the model</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">scenarios</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">scenarios</span><span class="p">[</span><span class="s1">&#39;base&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">()</span>
    
    <span class="c1"># extra triage capacity</span>
    <span class="n">scenarios</span><span class="p">[</span><span class="s1">&#39;triage+1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">n_triage</span><span class="o">=</span><span class="n">DEFAULT_N_TRIAGE</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="c1"># extra examination capacity</span>
    <span class="n">scenarios</span><span class="p">[</span><span class="s1">&#39;exam+1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">n_exam</span><span class="o">=</span><span class="n">DEFAULT_N_EXAM</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># extra non-trauma treatment capacity</span>
    <span class="n">scenarios</span><span class="p">[</span><span class="s1">&#39;treat+1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">n_cubicles_1</span><span class="o">=</span><span class="n">DEFAULT_N_CUBICLES_1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">scenarios</span><span class="p">[</span><span class="s1">&#39;triage+exam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Scenario</span><span class="p">(</span><span class="n">n_triage</span><span class="o">=</span><span class="n">DEFAULT_N_TRIAGE</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                        <span class="n">n_exam</span><span class="o">=</span><span class="n">DEFAULT_N_EXAM</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">scenarios</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_scenario_analysis</span><span class="p">(</span><span class="n">scenarios</span><span class="p">,</span> <span class="n">rc_period</span><span class="p">,</span> <span class="n">n_reps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run each of the scenarios for a specified results</span>
<span class="sd">    collection period and replications.</span>
<span class="sd">    </span>
<span class="sd">    Params:</span>
<span class="sd">    ------</span>
<span class="sd">    scenarios: dict</span>
<span class="sd">        dictionary of Scenario objects</span>
<span class="sd">        </span>
<span class="sd">    rc_period: float</span>
<span class="sd">        model run length</span>
<span class="sd">        </span>
<span class="sd">    n_rep: int</span>
<span class="sd">        Number of replications</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Scenario Analysis&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No. Scenario: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">scenarios</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Replications: </span><span class="si">{</span><span class="n">n_reps</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">scenario_results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">sc_name</span><span class="p">,</span> <span class="n">scenario</span> <span class="ow">in</span> <span class="n">scenarios</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Running </span><span class="si">{</span><span class="n">sc_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39; =&gt; &#39;</span><span class="p">)</span>
        <span class="n">replications</span> <span class="o">=</span> <span class="n">multiple_replications</span><span class="p">(</span><span class="n">scenario</span><span class="p">,</span> <span class="n">rc_period</span><span class="o">=</span><span class="n">rc_period</span><span class="p">,</span>
                                              <span class="n">n_reps</span><span class="o">=</span><span class="n">n_reps</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;done.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        
        <span class="c1">#save the results</span>
        <span class="n">scenario_results</span><span class="p">[</span><span class="n">sc_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">replications</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Scenario analysis complete.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">scenario_results</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="script-to-run-scenario-analysis">
<h3>10.1 Script to run scenario analysis<a class="headerlink" href="#script-to-run-scenario-analysis" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#number of replications</span>
<span class="n">N_REPS</span> <span class="o">=</span> <span class="mi">20</span>

<span class="c1">#get the scenarios</span>
<span class="n">scenarios</span> <span class="o">=</span> <span class="n">get_scenarios</span><span class="p">()</span>

<span class="c1">#run the scenario analysis</span>
<span class="n">scenario_results</span> <span class="o">=</span> <span class="n">run_scenario_analysis</span><span class="p">(</span><span class="n">scenarios</span><span class="p">,</span> 
                                         <span class="n">DEFAULT_RESULTS_COLLECTION_PERIOD</span><span class="p">,</span>
                                         <span class="n">N_REPS</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Scenario Analysis
No. Scenario: 5
Replications: 20
Running base =&gt; 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>done.

Running triage+1 =&gt; 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>done.

Running exam+1 =&gt; 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>done.

Running treat+1 =&gt; 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>done.

Running triage+exam =&gt; 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>done.

Scenario analysis complete.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scenario_summary_frame</span><span class="p">(</span><span class="n">scenario_results</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Mean results for each performance measure by scenario</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    ----------</span>
<span class="sd">    scenario_results: dict</span>
<span class="sd">        dictionary of replications.  </span>
<span class="sd">        Key identifies the performance measure</span>
<span class="sd">        </span>
<span class="sd">    Returns:</span>
<span class="sd">    -------</span>
<span class="sd">    pd.DataFrame</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">sc_name</span><span class="p">,</span> <span class="n">replications</span> <span class="ow">in</span> <span class="n">scenario_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">summary</span><span class="p">,</span> <span class="n">replications</span><span class="o">.</span><span class="n">mean</span><span class="p">()],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">columns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sc_name</span><span class="p">)</span>

    <span class="n">summary</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
    <span class="k">return</span> <span class="n">summary</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># as well as rounding you may want to rename the cols/rows to </span>
<span class="c1"># more readable alternatives.</span>
<span class="n">summary_frame</span> <span class="o">=</span> <span class="n">scenario_summary_frame</span><span class="p">(</span><span class="n">scenario_results</span><span class="p">)</span>
<span class="n">summary_frame</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>base</th>
      <th>triage+1</th>
      <th>exam+1</th>
      <th>treat+1</th>
      <th>triage+exam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>00_arrivals</th>
      <td>227.25</td>
      <td>227.25</td>
      <td>227.25</td>
      <td>227.25</td>
      <td>227.25</td>
    </tr>
    <tr>
      <th>01a_triage_wait</th>
      <td>32.56</td>
      <td>1.26</td>
      <td>32.56</td>
      <td>32.56</td>
      <td>1.26</td>
    </tr>
    <tr>
      <th>01b_triage_util</th>
      <td>0.61</td>
      <td>0.31</td>
      <td>0.61</td>
      <td>0.61</td>
      <td>0.31</td>
    </tr>
    <tr>
      <th>02a_registration_wait</th>
      <td>104.69</td>
      <td>131.82</td>
      <td>104.69</td>
      <td>104.69</td>
      <td>131.82</td>
    </tr>
    <tr>
      <th>02b_registration_util</th>
      <td>0.85</td>
      <td>0.85</td>
      <td>0.85</td>
      <td>0.85</td>
      <td>0.85</td>
    </tr>
    <tr>
      <th>03a_examination_wait</th>
      <td>23.36</td>
      <td>24.44</td>
      <td>0.14</td>
      <td>23.36</td>
      <td>0.14</td>
    </tr>
    <tr>
      <th>03b_examination_util</th>
      <td>0.86</td>
      <td>0.86</td>
      <td>0.67</td>
      <td>0.86</td>
      <td>0.67</td>
    </tr>
    <tr>
      <th>04a_treatment_wait(non_trauma)</th>
      <td>130.73</td>
      <td>133.09</td>
      <td>144.50</td>
      <td>2.15</td>
      <td>147.81</td>
    </tr>
    <tr>
      <th>04b_treatment_util(non_trauma)</th>
      <td>0.88</td>
      <td>0.88</td>
      <td>0.88</td>
      <td>0.62</td>
      <td>0.88</td>
    </tr>
    <tr>
      <th>05_total_time(non-trauma)</th>
      <td>229.04</td>
      <td>226.38</td>
      <td>218.29</td>
      <td>187.98</td>
      <td>215.06</td>
    </tr>
    <tr>
      <th>06a_trauma_wait</th>
      <td>166.98</td>
      <td>189.67</td>
      <td>166.98</td>
      <td>166.98</td>
      <td>189.67</td>
    </tr>
    <tr>
      <th>06b_trauma_util</th>
      <td>0.84</td>
      <td>0.86</td>
      <td>0.84</td>
      <td>0.84</td>
      <td>0.86</td>
    </tr>
    <tr>
      <th>07a_treatment_wait(trauma)</th>
      <td>14.39</td>
      <td>14.77</td>
      <td>14.39</td>
      <td>14.39</td>
      <td>14.77</td>
    </tr>
    <tr>
      <th>07b_treatment_util(trauma)</th>
      <td>0.52</td>
      <td>0.52</td>
      <td>0.52</td>
      <td>0.52</td>
      <td>0.52</td>
    </tr>
    <tr>
      <th>08_total_time(trauma)</th>
      <td>306.46</td>
      <td>298.22</td>
      <td>306.46</td>
      <td>306.46</td>
      <td>298.22</td>
    </tr>
    <tr>
      <th>09_throughput</th>
      <td>165.85</td>
      <td>166.65</td>
      <td>169.10</td>
      <td>196.85</td>
      <td>169.85</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="script-to-produce-formatted-latex-table-for-paper">
<h2>11. Script to produce formatted LaTeX table for paper<a class="headerlink" href="#script-to-produce-formatted-latex-table-for-paper" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">HEADER_URL</span> <span class="o">=</span> <span class="s1">&#39;data/tbl_row_headers.csv&#39;</span>
<span class="n">WAIT</span> <span class="o">=</span> <span class="s1">&#39;wait&#39;</span>

<span class="c1"># filter for waiting times only and round to 2dp</span>
<span class="n">waiting_times</span> <span class="o">=</span> <span class="n">summary_frame</span><span class="p">[</span><span class="n">summary_frame</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">WAIT</span><span class="p">)]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># load formatted table headers</span>
<span class="n">row_headers</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">HEADER_URL</span><span class="p">)</span>

<span class="c1"># merge and format headers</span>
<span class="n">waiting_times</span> <span class="o">=</span> <span class="n">waiting_times</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">waiting_times</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">row_headers</span><span class="p">,</span> <span class="n">waiting_times</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">waiting_times</span> <span class="o">=</span> <span class="n">waiting_times</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">row_headers</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">waiting_times</span> <span class="o">=</span> <span class="n">waiting_times</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;index&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">waiting_times</span> <span class="o">=</span> <span class="n">waiting_times</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">waiting_times</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Mean waiting time (mins)</th>
      <th>base</th>
      <th>triage+1</th>
      <th>exam+1</th>
      <th>treat+1</th>
      <th>triage+exam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Triage</td>
      <td>32.56</td>
      <td>1.26</td>
      <td>32.56</td>
      <td>32.56</td>
      <td>1.26</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Registation</td>
      <td>104.69</td>
      <td>131.82</td>
      <td>104.69</td>
      <td>104.69</td>
      <td>131.82</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Examination</td>
      <td>23.36</td>
      <td>24.44</td>
      <td>0.14</td>
      <td>23.36</td>
      <td>0.14</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Non-trauma treatment</td>
      <td>130.73</td>
      <td>133.09</td>
      <td>144.50</td>
      <td>2.15</td>
      <td>147.81</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Trauma stabilisation</td>
      <td>166.98</td>
      <td>189.67</td>
      <td>166.98</td>
      <td>166.98</td>
      <td>189.67</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Trauma treatment</td>
      <td>14.39</td>
      <td>14.77</td>
      <td>14.39</td>
      <td>14.39</td>
      <td>14.77</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># output to file as LaTeX</span>
<span class="n">OUTPUT_FILE</span> <span class="o">=</span> <span class="s1">&#39;output/table_3.txt&#39;</span>
<span class="n">LABEL</span> <span class="o">=</span> <span class="s1">&#39;tab:table3&#39;</span>
<span class="n">CAPTION</span> <span class="o">=</span> <span class="s1">&#39;Simulation results that can be verified by our example reproducible pipeline.&#39;</span>

<span class="n">waiting_times</span><span class="o">.</span><span class="n">to_latex</span><span class="p">(</span><span class="n">OUTPUT_FILE</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">LABEL</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="n">CAPTION</span><span class="p">)</span>

<span class="c1"># modify LaTeX file -&gt; convert \caption to \tbl</span>
<span class="k">with</span> <span class="n">fileinput</span><span class="o">.</span><span class="n">FileInput</span><span class="p">(</span><span class="n">OUTPUT_FILE</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">as</span> <span class="n">latex_file</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">latex_file</span><span class="p">:</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;caption&#39;</span><span class="p">,</span> <span class="s1">&#39;tbl&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="c1"># view LaTeX to verify</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">OUTPUT_FILE</span><span class="p">,</span> <span class="s2">&quot;r+&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file1</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file1</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>\begin{table}
\tbl{Simulation results that can be verified by our example reproducible pipeline.}
\label{tab:table3}
\begin{tabular}{lrrrrr}
\toprule
Mean waiting time (mins) &amp; base &amp; triage+1 &amp; exam+1 &amp; treat+1 &amp; triage+exam \\
\midrule
Triage &amp; 32.560000 &amp; 1.260000 &amp; 32.560000 &amp; 32.560000 &amp; 1.260000 \\
Registation &amp; 104.690000 &amp; 131.820000 &amp; 104.690000 &amp; 104.690000 &amp; 131.820000 \\
Examination &amp; 23.360000 &amp; 24.440000 &amp; 0.140000 &amp; 23.360000 &amp; 0.140000 \\
Non-trauma treatment &amp; 130.730000 &amp; 133.090000 &amp; 144.500000 &amp; 2.150000 &amp; 147.810000 \\
Trauma stabilisation &amp; 166.980000 &amp; 189.670000 &amp; 166.980000 &amp; 166.980000 &amp; 189.670000 \\
Trauma treatment &amp; 14.390000 &amp; 14.770000 &amp; 14.390000 &amp; 14.390000 &amp; 14.770000 \\
\bottomrule
\end{tabular}
\end{table}
</pre></div>
</div>
</div>
</div>
</section>
<section id="end">
<h2>End<a class="headerlink" href="#end" title="Link to this heading">#</a></h2>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "TomMonks/treatment-centre-sim",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content/02_model_code"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="03a_summary.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Model technical summary</p>
      </div>
    </a>
    <a class="right-next"
       href="05_testing.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Model testing</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">1. Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constants-and-defaults-for-modelling-as-is">2. Constants and defaults for modelling <strong>as-is</strong></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-parameters">2.1 Distribution parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-dependent-arrival-rates-data">2.2 Time dependent arrival rates data</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resource-counts">2.3 Resource counts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#simulation-model-run-settings">2.4 Simulation model run settings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#utility-functions">3. Utility functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#distribution-classes">4. Distribution classes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-parameterisation">5. Model parameterisation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#patient-pathways-process-logic">6. Patient Pathways Process Logic</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-model-class">7. Main model class</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logic-to-process-end-of-run-results">8. Logic to process end of run results.</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-execution">9. Model execution</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#single-run-of-the-model">9.1 Single run of the model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-independent-replications">9.2 Multiple independent replications</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualise-replications">9.3 Visualise replications</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#script-to-run-scenario-analysis">10.1 Script to run scenario analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#script-to-produce-formatted-latex-table-for-paper">11. Script to produce formatted LaTeX table for paper</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#end">End</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Thomas Monks
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>